<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calverse</title>
    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* --- Professional Dark Mode UI --- */
        :root {
            --primary-color: #facc15; /* Gold/Yellow */
            --background-color: #111111;
            --surface-color: #1e1e1e;
            --text-color: #f5f5f5;
            --text-muted-color: #a3a3a3;
            --border-color: #2e2e2e;
            --error-color: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .app-container {
            display: flex;
        }

        /* --- Sidebar Navigation (Desktop) --- */
        .sidebar {
            display: none; /* Hidden on mobile */
            width: 240px;
            background-color: var(--background-color);
            border-right: 1px solid var(--border-color);
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 2.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar .nav-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .sidebar .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            color: var(--text-muted-color);
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }
        
        .sidebar .nav-link:hover {
            background-color: var(--surface-color);
        }

        .sidebar .nav-link.active {
            background-color: var(--primary-color);
            color: #000;
        }
        
        .sidebar .nav-link.active .material-icons {
             color: #000;
        }

        /* --- Main Content --- */
        .main-content {
            width: 100%;
            padding: 1.5rem;
            padding-bottom: 100px; /* Space for bottom nav */
        }

        /* --- Header (Mobile) --- */
        .mobile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .mobile-header .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        #user-profile-icon {
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--surface-color);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        #user-profile-icon img {
            width: 100%; height: 100%; object-fit: cover;
        }
        
        #user-profile-icon .material-icons {
             font-size: 2.5rem; color: var(--text-muted-color);
        }

        /* --- Page Sections --- */
        .page-section {
            display: none;
        }
        .page-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .page-subtitle {
            color: var(--text-muted-color);
            margin-bottom: 2rem;
        }

        /* --- Card & Input Styles --- */
        .card {
            background-color: var(--surface-color);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }
        
        .input-group {
            position: relative;
            margin-bottom: 1rem;
        }
        
        .input-group .material-icons {
            position: absolute;
            top: 50%;
            left: 1rem;
            transform: translateY(-50%);
            color: var(--text-muted-color);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 1rem;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .input-group input {
             padding-left: 3rem;
        }
        
        textarea { min-height: 120px; }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.3);
        }

        .suggestion-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .pill {
            background-color: var(--border-color);
            color: var(--text-muted-color);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .pill:hover {
            background-color: #3f3f46;
        }
        
        button {
            background-color: var(--primary-color);
            color: #000;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            width: 100%;
            transition: background-color 0.2s;
        }

        /* --- Results & Utility --- */
        .results-container {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--background-color);
            border-radius: 8px;
            min-height: 50px;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        .loader {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .disclaimer {
            font-size: 0.8rem;
            color: var(--text-muted-color);
            padding: 0.75rem;
            border-radius: 8px;
            margin-top: 1rem;
            text-align: center;
        }

        /* --- Bottom Navigation (Mobile) --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0;
            z-index: 100;
        }
        
        .bottom-nav .nav-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-muted-color);
            text-decoration: none;
            padding: 0.5rem;
            flex-grow: 1;
        }
        
        .bottom-nav .nav-link.active {
            color: var(--primary-color);
        }

        /* --- Responsive Layout --- */
        @media (min-width: 768px) {
            .sidebar {
                display: flex;
            }
            .main-content {
                margin-left: 240px;
                padding: 2.5rem;
            }
            .mobile-header, .bottom-nav {
                display: none;
            }
        }
        
        /* Login Modal remains similar */
        .modal-overlay {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.8); justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: var(--surface-color); margin: auto; padding: 2rem; border: 1px solid var(--border-color);
            width: 90%; max-width: 400px; border-radius: 16px; text-align: center;
            animation: slideIn 0.3s ease-out; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #login-with-google-btn {
            background-color: #4285F4; color: #fff; width: 100%; margin-top: 1.5rem;
            display: flex; align-items: center; justify-content: center; gap: 0.75rem;
        }
        #login-with-google-btn img {
            width: 20px; height: 20px; background-color: #fff; border-radius: 50%; padding: 2px;
        }
        
    </style>
</head>
<body>

    <div class="app-container">
        <!-- Sidebar for Desktop -->
        <nav class="sidebar">
            <div class="logo"><span class="material-icons">spa</span>Calverse</div>
            <ul class="nav-links">
                <li><a href="#" class="nav-link active" data-target="nutrition"><span class="material-icons">search</span>Nutrition</a></li>
                <li><a href="#" class="nav-link" data-target="meal"><span class="material-icons">restaurant_menu</span>Your Meal</a></li>
                <li><a href="#" class="nav-link" data-target="recipe"><span class="material-icons">menu_book</span>Recipes</a></li>
                <li><a href="#" class="nav-link" data-target="calculators"><span class="material-icons">calculate</span>Calculators</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mobile Header -->
            <header class="mobile-header">
                <div class="logo">Calverse</div>
                <div id="user-profile-icon">
                    <span class="material-icons">account_circle</span>
                </div>
            </header>

            <!-- Section 1: Nutrition Search -->
            <section id="nutrition" class="page-section active">
                <h1 class="page-title">Calorie Chart & Nutrition Facts</h1>
                <p class="page-subtitle">Search for a food or select a suggestion.</p>
                <div class="card">
                    <div class="input-group">
                        <span class="material-icons">search</span>
                        <input type="text" id="food-search-input" placeholder="E.g., 'Apple' or 'Big Mac'">
                    </div>
                    <div class="suggestion-pills">
                        <span class="pill">Chicken Breast</span>
                        <span class="pill">Salad</span>
                        <span class="pill">Banana</span>
                        <span class="pill">Protein Shake</span>
                        <span class="pill">Oats</span>
                        <span class="pill">Egg</span>
                    </div>
                </div>
                <div id="nutrition-results" class="results-container" style="display:none;"></div>
            </section>

            <!-- Section 2: Know Your Meal -->
            <section id="meal" class="page-section">
                 <h1 class="page-title">Know Your Meal</h1>
                 <p class="page-subtitle">Analyze ingredients to understand your meal's nutrition.</p>
                 <div class="card">
                    <textarea id="meal-ingredients-input" placeholder="e.g.,&#10;1 cup rice&#10;150g lentils&#10;1 tbsp olive oil"></textarea>
                    <button id="analyze-meal-btn" style="margin-top: 1rem;">Analyze Ingredients</button>
                 </div>
                 <div id="meal-results" class="results-container" style="display:none;"></div>
            </section>
            
            <!-- Section 3: Recipe Suggestions -->
            <section id="recipe" class="page-section">
                <h1 class="page-title">Recipe Ideas</h1>
                <p class="page-subtitle">Get recipes based on ingredients or cravings.</p>
                <div class="card">
                    <label>What ingredients do you have?</label>
                    <textarea id="recipe-ingredients-input" placeholder="e.g., chicken, tomatoes, onions" style="margin-top:0.5rem;"></textarea>
                    <button id="get-recipe-btn" style="margin-top: 1rem;">Suggest a Recipe</button>
                </div>
                <div class="card">
                    <label>What are you craving?</label>
                    <input type="text" id="craving-input" placeholder="e.g., something sweet and chocolaty" style="margin-top:0.5rem;">
                    <button id="get-craving-btn" style="margin-top: 1rem;">Find Healthier Alternative</button>
                </div>
                <div id="recipe-results" class="results-container" style="display:none;"></div>
            </section>

            <!-- Section 4: Calculators -->
            <section id="calculators" class="page-section">
                 <h1 class="page-title">Health Calculators</h1>
                 <p class="page-subtitle">Select a tool to calculate your health metrics.</p>
                 <div id="calculators-list">
                     <!-- Calculators will be rendered here by JS -->
                 </div>
            </section>
        </main>
    </div>
    
    <!-- Bottom Navigation for Mobile -->
    <nav class="bottom-nav">
        <a href="#" class="nav-link active" data-target="nutrition"><span class="material-icons">home</span>Home</a>
        <a href="#" class="nav-link" data-target="meal"><span class="material-icons">restaurant_menu</span>Meal</a>
        <a href="#" class="nav-link" data-target="recipe"><span class="material-icons">menu_book</span>Recipes</a>
        <a href="#" class="nav-link" data-target="calculators"><span class="material-icons">calculate</span>Calculators</a>
    </nav>
    
    <!-- Login Modal -->
    <div id="login-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Welcome to Calverse</h3>
            <p>Sign in with Google to save your data and track your nutrition journey.</p>
            <div id="login-error-message" style="display: none; margin: 1rem 0; color: var(--error-color);"></div>
            <button id="login-with-google-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
                Sign in with Google
            </button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Config ---
        const GEMINI_API_KEYS = [
            "AIzaSyCiPL-DcZN82CxH6OmYv9Ll4yM3WiVjxXY",
            "AIzaSyAvU63lMyAjbSJfcTBuBnkZQ0DPoBpm6Ho",
            "AIzaSyAIJZmqyztvwoThqI7iu2-xzQr71aJaKEU",
            "AIzaSyAmbO3Szmr9vAj24MkRkbMQeQi1j7_-m4Y"
        ];
        const firebaseConfig = {
            apiKey: "AIzaSyCu5RfnRhT9refiyybPcW_IBt_7l5cgt2I",
            authDomain: "calverse-e3cdb.firebaseapp.com",
            projectId: "calverse-e3cdb",
            storageBucket: "calverse-e3cdb.firebasestorage.app",
            messagingSenderId: "284415302963",
            appId: "1:284415302963:web:936ad62e589bad6fc9b246",
        };

        // --- Init Firebase ---
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUser = null;

        // --- Gemini API Call ---
        let currentApiKeyIndex = 0;
        async function geminiFetch(prompt, resultContainer) {
            showLoader(resultContainer);
            resultContainer.style.display = 'block';
            for (let i = 0; i < GEMINI_API_KEYS.length; i++) {
                const apiKey = GEMINI_API_KEYS[currentApiKeyIndex];
                const url = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    if (!response.ok) throw new Error(`API Error ${response.status}`);
                    const data = await response.json();
                    if (data.candidates && data.candidates.length > 0) {
                        hideLoader(resultContainer);
                        return data.candidates[0].content.parts[0].text;
                    } else { throw new Error("Invalid response structure."); }
                } catch (error) {
                    console.warn(`API Key ${currentApiKeyIndex + 1} failed. Trying next.`);
                    currentApiKeyIndex = (currentApiKeyIndex + 1) % GEMINI_API_KEYS.length;
                }
            }
            hideLoader(resultContainer);
            resultContainer.innerHTML = `<p style="color: var(--error-color);">Service is currently unavailable. Please try again later.</p>`;
            return null;
        }

        // --- Auth ---
        const loginModal = document.getElementById('login-modal');
        auth.onAuthStateChanged(user => {
            currentUser = user;
            loginModal.style.display = user ? 'none' : 'flex';
            if (user) document.getElementById('user-profile-icon').innerHTML = `<img src="${user.photoURL}" alt="Profile">`;
        });
        document.getElementById('login-with-google-btn').addEventListener('click', () => {
            auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).catch(err => {
                document.getElementById('login-error-message').textContent = 'Login failed. Please try again.';
                document.getElementById('login-error-message').style.display = 'block';
            });
        });

        // --- Navigation ---
        const navLinks = document.querySelectorAll('.nav-link');
        const pageSections = document.querySelectorAll('.page-section');
        function switchPage(targetId) {
            pageSections.forEach(section => section.classList.remove('active'));
            document.getElementById(targetId)?.classList.add('active');
            navLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.target === targetId);
            });
        }
        navLinks.forEach(link => link.addEventListener('click', (e) => {
            e.preventDefault();
            switchPage(e.currentTarget.dataset.target);
        }));

        // --- Nutrition Search ---
        const foodSearchInput = document.getElementById('food-search-input');
        const nutritionResults = document.getElementById('nutrition-results');
        async function searchFood(query) {
            if (!query) return;
            foodSearchInput.value = query;
            const prompt = `Provide a detailed nutrition facts label for "${query}". The output should be plain text, formatted like a standard US nutrition label. Include values for Calories, Total Fat, Saturated Fat, Trans Fat, Cholesterol, Sodium, Total Carbohydrate, Dietary Fiber, Total Sugars, and Protein. Also include values for Vitamin D, Calcium, Iron, and Potassium.`;
            const result = await geminiFetch(prompt, nutritionResults);
            if (result) nutritionResults.textContent = result;
        }
        foodSearchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') searchFood(e.target.value.trim()); });
        document.querySelectorAll('.pill').forEach(pill => pill.addEventListener('click', () => searchFood(pill.textContent)));
        
        // --- Meal & Recipe ---
        document.getElementById('analyze-meal-btn').addEventListener('click', async () => {
            const ingredients = document.getElementById('meal-ingredients-input').value.trim();
            if (!ingredients) return;
            const prompt = `Analyze the nutritional content of a meal with these ingredients:\n${ingredients}\n\nFirst, provide an estimated total for key nutrients (Calories, Protein, Carbs, Fat). Then, give two specific, actionable suggestions to make this meal healthier and tastier. Format the entire response clearly with headings.`;
            const result = await geminiFetch(prompt, document.getElementById('meal-results'));
            if (result) document.getElementById('meal-results').textContent = result;
        });
        document.getElementById('get-recipe-btn').addEventListener('click', async () => {
            const ingredients = document.getElementById('recipe-ingredients-input').value.trim();
            if (!ingredients) return;
            const prompt = `I have the following ingredients: ${ingredients}. Suggest a healthy and delicious recipe I can make. Provide a name for the recipe, a list of required ingredients, and a step-by-step cooking process.`;
            const result = await geminiFetch(prompt, document.getElementById('recipe-results'));
            if (result) document.getElementById('recipe-results').textContent = result;
        });
        document.getElementById('get-craving-btn').addEventListener('click', async () => {
            const craving = document.getElementById('craving-input').value.trim();
            if (!craving) return;
            const prompt = `I'm craving "${craving}". Suggest a healthier, delicious alternative. Provide a recipe name, ingredients, and step-by-step instructions to make it.`;
            const result = await geminiFetch(prompt, document.getElementById('recipe-results'));
            if (result) document.getElementById('recipe-results').textContent = result;
        });

        // --- Calculators ---
        const calculatorsList = document.getElementById('calculators-list');
        const calculatorData = {
            bmi: { title: 'BMI Calculator', icon: 'monitor_weight', inputs: [{id: 'bmi-weight', label: 'Weight (kg)'}, {id: 'bmi-height', label: 'Height (cm)'}], func: 'calculateBMI'},
            bmr: { title: 'BMR Calculator', icon: 'local_fire_department', inputs: [{id: 'bmr-weight', label: 'Weight (kg)'}, {id: 'bmr-height', label: 'Height (cm)'}, {id: 'bmr-age', label: 'Age'}, {id: 'bmr-gender', label: 'Gender', type: 'select', options: ['Male', 'Female']}], func: 'calculateBMR'},
            bodyFat: { title: 'Body Fat Calculator', icon: 'fitness_center', inputs: [{id: 'bf-height', label: 'Height (cm)'}, {id: 'bf-neck', label: 'Neck (cm)'}, {id: 'bf-waist', label: 'Waist (cm)'}, {id: 'bf-hip', label: 'Hip (cm)', femaleOnly: true}, {id: 'bf-gender', label: 'Gender', type: 'select', options: ['Male', 'Female']}], func: 'calculateBodyFat'},
            idealWeight: { title: 'Ideal Weight Calculator', icon: 'scale', inputs: [{id: 'iw-height', label: 'Height (cm)'}, {id: 'iw-gender', label: 'Gender', type: 'select', options: ['Male', 'Female']}], func: 'calculateIdealWeight'},
            lbm: { title: 'Lean Body Mass Calculator', icon: 'directions_run', inputs: [{id: 'lbm-weight', label: 'Weight (kg)'}, {id: 'lbm-height', label: 'Height (cm)'}, {id: 'lbm-gender', label: 'Gender', type: 'select', options: ['Male', 'Female']}], func: 'calculateLBM'},
            ovulation: { title: 'Ovulation Calculator', icon: 'calendar_month', inputs: [{id: 'ov-last-period', label: 'First Day of Last Period', type: 'date'}, {id: 'ov-cycle-length', label: 'Avg. Cycle (days)'}], func: 'calculateOvulation'},
        };
        
        function renderCalculators() {
            let html = '';
            for (const key in calculatorData) {
                const calc = calculatorData[key];
                let inputsHtml = calc.inputs.map(input => {
                    if (input.type === 'select') {
                        return `<div class="input-group" ${input.femaleOnly ? `id="${input.id}-group"` : ''}><label>${input.label}</label><select id="${input.id}">${input.options.map(o => `<option value="${o.toLowerCase()}">${o}</option>`).join('')}</select></div>`;
                    }
                    return `<div class="input-group"><label>${input.label}</label><input type="${input.type || 'number'}" id="${input.id}"></div>`;
                }).join('');
                html += `
                <div class="card">
                    <h3><span class="material-icons">${calc.icon}</span> ${calc.title}</h3>
                    <div class="calc-inputs">${inputsHtml}</div>
                    <button onclick="${calc.func}()">Calculate</button>
                    <div id="${key}-results" class="results-container" style="display:none;"></div>
                    <p class="disclaimer">Estimates are for informational purposes only.</p>
                </div>`;
            }
            calculatorsList.innerHTML = html;
            // Add event listener for body fat hip input
            const bfGenderSelect = document.getElementById('bf-gender');
            if (bfGenderSelect) {
                const hipGroup = document.getElementById('bf-hip-group');
                if (hipGroup) { // Check if the hip input group exists
                    bfGenderSelect.addEventListener('change', (e) => {
                        hipGroup.style.display = e.target.value === 'female' ? 'block' : 'none';
                    });
                    // Initial hide
                    hipGroup.style.display = 'none';
                }
            }
        }
        renderCalculators();
        
        // --- Calculation Functions ---
        const showResult = (id, content) => {
            const el = document.getElementById(id);
            el.innerHTML = content;
            el.style.display = 'block';
        };
        window.calculateBMI = () => {
            const w = parseFloat(document.getElementById('bmi-weight').value), h = parseFloat(document.getElementById('bmi-height').value);
            if (!w || !h) return;
            const bmi = (w / ((h / 100) ** 2)).toFixed(1);
            let cat = bmi < 18.5 ? 'Underweight' : bmi < 25 ? 'Normal' : bmi < 30 ? 'Overweight' : 'Obesity';
            showResult('bmi-results', `<h4>Your BMI is ${bmi} (${cat})</h4>`);
        };
        window.calculateBMR = () => {
            const w = parseFloat(document.getElementById('bmr-weight').value), h = parseFloat(document.getElementById('bmr-height').value), age = parseInt(document.getElementById('bmr-age').value), g = document.getElementById('bmr-gender').value;
            if (!w || !h || !age) return;
            let bmr = g === 'male' ? (10 * w) + (6.25 * h) - (5 * age) + 5 : (10 * w) + (6.25 * h) - (5 * age) - 161;
            showResult('bmr-results', `<h4>Est. BMR: ${bmr.toFixed(0)} kcal/day</h4>`);
        };
        window.calculateBodyFat = () => {
            const h = parseFloat(document.getElementById('bf-height').value), n = parseFloat(document.getElementById('bf-neck').value), w = parseFloat(document.getElementById('bf-waist').value), g = document.getElementById('bf-gender').value;
            const hip = parseFloat(document.getElementById('bf-hip').value);
            if (!h || !n || !w || (g === 'female' && !hip)) return;
            let bfp = g === 'male' ? 495 / (1.0324 - 0.19077 * Math.log10(w - n) + 0.15456 * Math.log10(h)) - 450 : 495 / (1.29579 - 0.35004 * Math.log10(w + hip - n) + 0.22100 * Math.log10(h)) - 450;
            showResult('bodyFat-results', `<h4>Est. Body Fat: ${bfp.toFixed(1)}%</h4>`);
        };
        window.calculateIdealWeight = () => {
            const h = parseFloat(document.getElementById('iw-height').value), g = document.getElementById('iw-gender').value;
            if (!h) return;
            let iw = g === 'male' ? 50 + 0.91 * (h - 152.4) : 45.5 + 0.91 * (h - 152.4);
            showResult('idealWeight-results', `<h4>Est. Ideal Weight: ${iw.toFixed(1)} kg</h4>`);
        };
        window.calculateLBM = () => {
            const w = parseFloat(document.getElementById('lbm-weight').value), h = parseFloat(document.getElementById('lbm-height').value), g = document.getElementById('lbm-gender').value;
            if (!w || !h) return;
            let lbm = g === 'male' ? (0.407 * w) + (0.267 * h) - 19.2 : (0.252 * w) + (0.473 * h) - 48.3;
            showResult('lbm-results', `<h4>Est. Lean Body Mass: ${lbm.toFixed(1)} kg</h4>`);
        };
        window.calculateOvulation = () => {
            const lastPeriod = new Date(document.getElementById('ov-last-period').value), cycle = parseInt(document.getElementById('ov-cycle-length').value);
            if (isNaN(lastPeriod.getTime()) || !cycle) return;
            const ovulationDate = new Date(lastPeriod);
            ovulationDate.setDate(lastPeriod.getDate() + cycle - 14);
            const fertileStart = new Date(ovulationDate);
            fertileStart.setDate(ovulationDate.getDate() - 5);
            const opts = { month: 'long', day: 'numeric' };
            showResult('ovulation-results', `<h4>Est. Ovulation: ${ovulationDate.toLocaleDateString(undefined, opts)}</h4>`);
        };
        
        // --- UI Helpers ---
        const showLoader = (container) => { container.innerHTML = '<div class="loader"></div>'; };
        const hideLoader = (container) => { if (container.querySelector('.loader')) container.innerHTML = ''; };

    });
    </script>
</body>
</html>
