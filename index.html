<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuraFlex - AI Nutrition & Health</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-icons@latest/dist/lucide.min.js"></script>

    <!-- Custom Styles -->
    <style>
        :root {
            --background: #000000;
            --sidebar-bg: #101010;
            --card-bg: #1C1C1E;
            --border-color: #2C2C2E;
            --primary: #FFD60A;
            --primary-hover: #FFC300;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
            border-right: 1px solid var(--border-color);
        }
        .bottom-nav {
            border-top: 1px solid var(--border-color);
            background: rgba(28, 28, 30, 0.8);
            backdrop-filter: blur(10px);
        }
        .nav-link.active {
            color: var(--primary);
        }
        .nav-link-bottom.active {
             color: var(--primary);
             background-color: rgba(255, 214, 10, 0.1);
        }
        .nutrition-label {
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            background-color: var(--card-bg);
            max-width: 400px;
            margin: auto;
        }
        .nutrition-label h1 {
            font-size: 2rem;
            font-weight: 800;
            line-height: 1.2;
        }
        .nutrition-label .header {
            border-bottom: 8px solid var(--border-color);
            padding-bottom: 0.75rem;
            margin-bottom: 0.75rem;
        }
        .ai-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }
        .ai-content ul {
            list-style-type: none;
            padding-left: 0;
        }
         .ai-content li {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: flex-start;
        }
        .ai-content li::before {
            content: '✓';
            color: var(--primary);
            font-weight: bold;
            margin-right: 0.75rem;
            margin-top: 0.125rem;
        }
        /* Scrollbar styles */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--sidebar-bg); }
        ::-webkit-scrollbar-thumb { background: #4A5568; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #718096; }
    </style>
</head>
<body class="bg-background text-text-primary">

    <div id="loading-overlay" class="fixed inset-0 bg-background bg-opacity-90 z-50 flex items-center justify-center">
        <div class="flex flex-col items-center">
            <svg class="animate-spin h-10 w-10 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <p class="mt-4 text-lg font-semibold">Initializing AuraFlex...</p>
        </div>
    </div>

    <div id="auth-container" class="hidden h-screen w-screen flex items-center justify-center bg-background p-4">
        <div class="text-center p-8 sm:p-12 bg-card-bg rounded-2xl shadow-2xl max-w-md mx-auto border border-border-color">
            <div class="flex justify-center mb-6"><div class="bg-primary text-black rounded-lg h-16 w-16 flex items-center justify-center text-4xl font-bold">A</div></div>
            <h1 class="text-4xl font-bold text-text-primary mb-2">Welcome to AuraFlex</h1>
            <p class="text-text-secondary mb-8">Track your fitness, achieve your goals.</p>
            <button id="google-signin-btn" class="w-full bg-primary hover:bg-primary-hover text-black font-bold py-3 px-4 rounded-lg flex items-center justify-center transition duration-300 ease-in-out shadow-lg">
                <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#4285F4" d="M43.611,20.083H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/><path fill="#34A853" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-5.657-5.657C30.01,35.091,27.215,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-5.657,5.657C9.033,40.519,15.903,44,24,44z"/><path fill="#FBBC05" d="M6.306,14.691l5.657,5.657C10.319,25.474,10,26.7,10,28s0.319,2.526,0.963,3.654l-5.657,5.657C3.033,34.046,2,29.268,2,24S3.033,13.954,6.306,14.691z"/><path fill="#EA4335" d="M24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C15.903,4,9.033,9.481,6.306,14.691l5.657,5.657C13.381,15.317,18.798,12,24,12z"/></svg>
                Sign In with Google
            </button>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="hidden">
        <div class="flex h-screen">
            <!-- Sidebar (for desktop) -->
            <aside class="hidden md:flex flex-col bg-sidebar-bg text-text-primary w-64 space-y-6 py-7 px-4">
                 <a href="#" class="text-white flex items-center space-x-3">
                    <div class="bg-primary text-black rounded-lg h-10 w-10 flex items-center justify-center text-2xl font-bold">A</div>
                    <span class="text-xl font-extrabold">AuraFlex</span>
                </a>
                <nav id="main-nav-desktop" class="flex-grow">
                    <a href="#home" class="nav-link flex items-center py-2.5 px-4 my-2 rounded-lg transition duration-200">
                        <i data-lucide="home" class="inline-block w-5 h-5 mr-3"></i> <span class="font-semibold">Home</span>
                    </a>
                    <a href="#nutrition-lookup" class="nav-link flex items-center py-2.5 px-4 my-2 rounded-lg transition duration-200">
                        <i data-lucide="utensils" class="inline-block w-5 h-5 mr-3"></i> <span class="font-semibold">Food</span>
                    </a>
                    <a href="#health-calculators" class="nav-link flex items-center py-2.5 px-4 my-2 rounded-lg transition duration-200">
                        <i data-lucide="calculator" class="inline-block w-5 h-5 mr-3"></i> <span class="font-semibold">Calculator</span>
                    </a>
                     <a href="#settings" class="nav-link flex items-center py-2.5 px-4 my-2 rounded-lg transition duration-200">
                        <i data-lucide="settings" class="inline-block w-5 h-5 mr-3"></i> <span class="font-semibold">Settings</span>
                    </a>
                </nav>
                 <button id="logout-btn-desktop" class="w-full mt-auto bg-card-bg hover:bg-red-600/20 text-red-500 font-bold py-2 px-4 rounded-lg flex items-center justify-center transition">
                    <i data-lucide="log-out" class="w-5 h-5 mr-2"></i> Logout
                </button>
            </aside>

            <!-- Main content -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <header class="md:hidden bg-sidebar-bg/80 backdrop-blur-sm sticky top-0 z-10 border-b border-border-color">
                    <div class="flex justify-between items-center p-4">
                        <div class="flex items-center space-x-2">
                           <div class="bg-primary text-black rounded-md h-8 w-8 flex items-center justify-center text-xl font-bold">A</div>
                           <span class="text-lg font-bold">AuraFlex</span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="bg-card-bg px-3 py-1.5 rounded-lg flex items-center space-x-2">
                                <i data-lucide="calendar" class="w-4 h-4 text-primary"></i>
                                <span id="current-date" class="text-sm font-semibold">Jul 22</span>
                            </div>
                            <button id="profile-avatar-btn">
                                <img id="user-avatar" src="https://placehold.co/40x40/FFD60A/000000?text=U" alt="User Avatar" class="w-9 h-9 rounded-full">
                            </button>
                        </div>
                    </div>
                </header>
                <main class="flex-1 overflow-x-hidden overflow-y-auto bg-background p-4 sm:p-6 lg:p-8 pb-24 md:pb-8">
                    
                    <!-- App Sections -->
                    <section id="home" class="app-section">
                         <div class="max-w-4xl mx-auto">
                            <h1 class="text-3xl font-bold mb-1">Welcome back, <span id="user-name-welcome"></span>!</h1>
                            <p class="text-text-secondary mb-8">"The only bad workout is the one that didn't happen."</p>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-card-bg p-4 rounded-xl border border-border-color col-span-2">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-text-secondary text-sm">Today's Goal</p>
                                            <p class="text-3xl font-bold text-primary">1550 <span class="text-lg">Kcal</span></p>
                                        </div>
                                        <img id="user-avatar-hero" src="https://placehold.co/64x64/FFD60A/000000?text=U" alt="User Avatar" class="w-16 h-16 rounded-full border-2 border-primary">
                                    </div>
                                </div>
                                <div class="bg-card-bg p-4 rounded-xl border border-border-color"><p class="text-text-secondary text-sm mb-1">Consumed</p><p class="text-2xl font-bold">989 <span class="text-base text-text-secondary">kcal</span></p></div>
                                <div class="bg-card-bg p-4 rounded-xl border border-border-color"><p class="text-text-secondary text-sm mb-1">Burned</p><p class="text-2xl font-bold">215 <span class="text-base text-text-secondary">kcal</span></p></div>
                                <div class="bg-card-bg p-4 rounded-xl border border-border-color"><p class="text-text-secondary text-sm mb-1">Goal</p><p class="text-2xl font-bold">1550 <span class="text-base text-text-secondary">kcal</span></p></div>
                                <div class="bg-card-bg p-4 rounded-xl border border-border-color"><p class="text-text-secondary text-sm mb-1">Net</p><p class="text-2xl font-bold">774 <span class="text-base text-text-secondary">kcal</span></p></div>
                            </div>

                            <div class="bg-card-bg p-4 mt-6 rounded-xl border border-border-color">
                                <p class="font-semibold mb-2">Today's Goal Progress</p>
                                <div class="w-full bg-border-color rounded-full h-2.5"><div class="bg-primary h-2.5 rounded-full" style="width: 64%"></div></div>
                                <div class="flex justify-between text-xs text-text-secondary mt-1"><span>64%</span><span>989 / 1550 kcal</span></div>
                            </div>
                         </div>
                    </section>
                    
                    <section id="nutrition-lookup" class="app-section hidden">
                        <div class="max-w-4xl mx-auto">
                            <h2 class="text-3xl font-bold mb-2">Calorie Chart & Nutrition Facts</h2>
                            <p class="text-text-secondary mb-8">Search for a food to find nutrition information.</p>
                            <div class="relative mb-8">
                                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-text-secondary"></i>
                                <input id="nutrition-input" type="text" placeholder="E.g., 'Apple' or 'Big Mac'" class="w-full bg-card-bg border border-border-color rounded-lg pl-12 pr-4 py-3 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition">
                            </div>
                            <button id="get-nutrition-btn" class="w-full bg-primary hover:bg-primary-hover text-black font-bold py-3 px-6 rounded-lg flex items-center justify-center transition shadow-lg">
                                <i data-lucide="bar-chart-3" class="w-5 h-5 mr-2"></i> Analyze
                            </button>
                            <div id="nutrition-output" class="mt-8"></div>
                        </div>
                    </section>

                    <section id="health-calculators" class="app-section hidden">
                        <div class="max-w-4xl mx-auto">
                            <h2 class="text-3xl font-bold mb-2">Health Calculators</h2>
                            <p class="text-text-secondary mb-8">A suite of tools to help you track your health metrics.</p>
                            <div id="calculator-accordion" class="space-y-4"></div>
                        </div>
                    </section>

                    <section id="settings" class="app-section hidden">
                        <div class="max-w-4xl mx-auto">
                            <h2 class="text-3xl font-bold mb-2">General Settings</h2>
                            <div class="mt-8 space-y-2">
                                <a href="#" class="flex justify-between items-center p-4 bg-card-bg rounded-lg border border-border-color hover:border-primary transition">
                                    <div class="flex items-center"><i data-lucide="user" class="w-5 h-5 mr-4 text-text-secondary"></i><span>Profile</span></div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-text-secondary"></i>
                                </a>
                                <a href="#" class="flex justify-between items-center p-4 bg-card-bg rounded-lg border border-border-color hover:border-primary transition">
                                    <div class="flex items-center"><i data-lucide="info" class="w-5 h-5 mr-4 text-text-secondary"></i><span>About Us</span></div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-text-secondary"></i>
                                </a>
                                <a href="#" class="flex justify-between items-center p-4 bg-card-bg rounded-lg border border-border-color hover:border-primary transition">
                                    <div class="flex items-center"><i data-lucide="help-circle" class="w-5 h-5 mr-4 text-text-secondary"></i><span>FAQ</span></div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-text-secondary"></i>
                                </a>
                                <a href="#" class="flex justify-between items-center p-4 bg-card-bg rounded-lg border border-border-color hover:border-primary transition">
                                    <div class="flex items-center"><i data-lucide="mail" class="w-5 h-5 mr-4 text-text-secondary"></i><span>Contact Us</span></div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-text-secondary"></i>
                                </a>
                            </div>
                             <button id="logout-btn-mobile" class="w-full mt-8 bg-card-bg hover:bg-red-600/20 text-red-500 font-bold py-3 px-4 rounded-lg flex items-center justify-center transition">
                                <i data-lucide="log-out" class="w-5 h-5 mr-2"></i> Logout
                            </button>
                             <footer class="text-center mt-12 text-text-secondary text-sm">Made with ❤️ by Ashutosh</footer>
                        </div>
                    </section>
                </main>
            </div>
        </div>

        <!-- Bottom Nav (for mobile) -->
        <nav id="main-nav-mobile" class="md:hidden fixed bottom-0 left-0 right-0 h-20 bottom-nav flex justify-around items-center">
            <a href="#home" class="nav-link-bottom flex flex-col items-center justify-center text-text-secondary transition p-2 rounded-lg w-1/4">
                <i data-lucide="home" class="w-6 h-6 mb-1"></i><span class="text-xs font-bold">Home</span>
            </a>
            <a href="#nutrition-lookup" class="nav-link-bottom flex flex-col items-center justify-center text-text-secondary transition p-2 rounded-lg w-1/4">
                <i data-lucide="utensils" class="w-6 h-6 mb-1"></i><span class="text-xs font-bold">Food</span>
            </a>
            <a href="#health-calculators" class="nav-link-bottom flex flex-col items-center justify-center text-text-secondary transition p-2 rounded-lg w-1/4">
                <i data-lucide="calculator" class="w-6 h-6 mb-1"></i><span class="text-xs font-bold">Calculator</span>
            </a>
            <a href="#settings" class="nav-link-bottom flex flex-col items-center justify-center text-text-secondary transition p-2 rounded-lg w-1/4">
                <i data-lucide="settings" class="w-6 h-6 mb-1"></i><span class="text-xs font-bold">Settings</span>
            </a>
        </nav>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCu5RfnRhT9refiyybPcW_IBt_7l5cgt2I",
            authDomain: "calverse-e3cdb.firebaseapp.com",
            projectId: "calverse-e3cdb",
            storageBucket: "calverse-e3cdb.firebasestorage.app",
            messagingSenderId: "284415302963",
            appId: "1:284415302963:web:936ad62e589bad6fc9b246",
            measurementId: "G-X28DSX7WYB"
        };
        
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("Firebase initialization failed:", e);
            document.body.innerHTML = `<div class="h-screen w-screen flex items-center justify-center text-center p-4"><p>Could not connect to the backend. Please check your Firebase configuration and API keys.</p></div>`;
        }

        const loadingOverlay = document.getElementById('loading-overlay');
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        
        onAuthStateChanged(auth, (user) => {
            loadingOverlay.classList.add('hidden');
            if (user) {
                handleUserLogin(user);
                authContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                setupApp();
            } else {
                authContainer.classList.remove('hidden');
                appContainer.classList.add('hidden');
            }
        });
        
        document.getElementById('google-signin-btn').addEventListener('click', () => signInWithPopup(auth, new GoogleAuthProvider()).catch(err => console.error("Sign in error", err)));

        const handleLogout = () => signOut(auth).then(() => window.location.reload());
        document.getElementById('logout-btn-desktop').addEventListener('click', handleLogout);
        document.getElementById('logout-btn-mobile').addEventListener('click', handleLogout);

        async function handleUserLogin(user) {
            const userRef = doc(db, "users", user.uid);
            try {
                const userDoc = await getDoc(userRef);
                if (!userDoc.exists()) {
                    await setDoc(userRef, {
                        uid: user.uid,
                        displayName: user.displayName,
                        email: user.email,
                        photoURL: user.photoURL,
                        createdAt: new Date()
                    });
                }
                updateUIWithUserData(user);
            } catch (error) {
                console.error("Error handling user login:", error);
                alert("There was an issue saving your user data. Please check Firestore permissions.");
            }
        }

        function updateUIWithUserData(user) {
            const photoUrl = user.photoURL || `https://placehold.co/64x64/FFD60A/000000?text=${user.displayName[0]}`;
            document.getElementById('user-avatar').src = photoUrl;
            document.getElementById('user-avatar-hero').src = photoUrl;
            document.getElementById('user-name-welcome').textContent = user.displayName.split(' ')[0];
        }
        
        function setupApp() {
            lucide.createIcons();
            
            const navLinks = document.querySelectorAll('.nav-link, .nav-link-bottom');
            const sections = document.querySelectorAll('.app-section');

            const updateActiveNav = (hash) => {
                navLinks.forEach(l => {
                    const linkHash = l.getAttribute('href');
                    if (linkHash === hash) {
                        l.classList.add('active');
                    } else {
                        l.classList.remove('active');
                    }
                });
                sections.forEach(s => s.id === hash.substring(1) ? s.classList.remove('hidden') : s.classList.add('hidden'));
            };

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetHash = link.getAttribute('href');
                    window.location.hash = targetHash;
                });
            });

            window.addEventListener('hashchange', () => updateActiveNav(window.location.hash || '#home'));
            updateActiveNav(window.location.hash || '#home');
            
            // Set current date
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
        
        // The rest of your application logic (Gemini, Calculators, etc.) would go here.
        // To keep this example focused on the UI/Auth fix, I've omitted the feature logic,
        // but you would integrate the previous feature functions here.
    </script>
</body>
</html>
